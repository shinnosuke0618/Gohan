<div class="container">
  <div class="row mt-5">
    <div class="col-md-10 mx-auto">
      <h2 class="table-active">投稿一覧</h2>

      <table class="table text-center">
        <thead>
          <tr>
            <th>タイトル</th>
            <th>ジャンル</th>
            <th>投稿者</th>
            <th>レビュー</th>
            <th></th>
            <th colspan="5"></th>
          </tr>
        </thead>
        <tbody>
        <% @posts.each do |post| %>
          <tr>
            <td>
              <%= link_to admin_post_path(post.id) do %>
              <%= post.title %>
              <% end %>
            </td>
            <td><%= post.genre.name %></td>
            <td>
              <%= post.customer.name %>
            </td>
            <td>
              <%= link_to admin_post_reviews_path(post.id) do %>
              <div class="average-review-rating" data-score=<%= post.avg_score %>></div>
                <script>
                  $('.average-review-rating').empty();
                  $('.average-review-rating').raty({
                    readOnly: true,
                    starOn: "<%= asset_path('star-on.png') %>",
                    starOff: "<%= asset_path('star-off.png') %>",
                    starHalf: "<%= asset_path('star-half.png') %>",
                    score: function() {
                      return $(this).attr('data-score')
                    }
                  });
                </script>
                <div class="average-score-display ml-3 pt-2">
                <%= post.avg_score %>点（<%= post.reviews.count %>件のレビュー）
              </div>
              <% end %>
            </td>
          </tr>
        <% end %>
        </tbody>
      </table>

      <%= paginate @posts %>

    </div>
  </div>
</div>